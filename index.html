<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8">
  <title>图片轮播</title>
  <style>
    body {
      margin: 0;
      font-family: sans-serif;
      text-align: center;
      background-color: #000;
    }

    #image-container {
      max-width: 100vw;
      max-height: 90vh;
      display: flex;
      justify-content: center;
      align-items: center;
      overflow: hidden;
      background-color: #000;
    }

    img {
      max-width: 100%;
      max-height: 100%;
      object-fit: contain; /* 保持比例不拉伸 */
      border-radius: 10px;
      display: none; /* 初始隐藏，加载成功再显示 */
    }

    button {
      margin: 15px auto;
      padding: 10px 20px;
      font-size: 18px;
      background-color: #2196f3;
      color: white;
      border: none;
      border-radius: 6px;
      cursor: pointer;
    }

    button:hover {
      background-color: #1976d2;
    }
  </style>
</head>
<body>

  <div id="image-container">
    <img id="slideshow" src="">
  </div>

  <button id="pauseBtn">暂停</button>

  <script>
    const imgEl = document.getElementById("slideshow");
    const pauseBtn = document.getElementById("pauseBtn");

    let isPaused = false;

    pauseBtn.addEventListener("click", () => {
      isPaused = !isPaused;
      pauseBtn.innerText = isPaused ? "继续" : "暂停";
    });

    async function fetchImageUrl() {
      try {
        const res = await fetch("https://v2.api-m.com/api/heisi");
        const data = await res.json();
        return data?.data;
      } catch (err) {
        console.error("接口请求失败", err);
        return null;
      }
    }

    async function startSlideshow() {
      while (true) {
        if (!isPaused) {
          const imageUrl = await fetchImageUrl();
          if (imageUrl) {
            await showImage(imageUrl);
            await wait(2000);
          } else {
            await wait(2000);
          }
        } else {
          await wait(500);
        }
      }
    }

    function showImage(url) {
      return new Promise((resolve) => {
        imgEl.style.display = "none"; // 先隐藏，避免闪图或破图

        imgEl.onload = () => {
          imgEl.style.display = "block";
          resolve();
        };

        imgEl.onerror = () => {
          console.error("图片加载失败");
          imgEl.style.display = "none";
          resolve(); // 跳过错误
        };

        imgEl.src = url;
      });
    }

    function wait(ms) {
      return new Promise((resolve) => setTimeout(resolve, ms));
    }

    startSlideshow();
  </script>

</body>
</html>
